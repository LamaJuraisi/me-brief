<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>ME Geopolitics Brief</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: Georgia, serif;
        max-width: 900px;
        margin: 0 auto;
        padding: 1rem 1rem 5rem;
        line-height: 1.6;
        color: #121212;
      }

      /* Header */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        border-bottom: 2px solid #121212;
        padding-bottom: 1rem;
        margin-bottom: 1rem;
        gap: 1rem;
      }

      h1 {
        font-size: 1.8rem;
        margin-bottom: 0.3rem;
      }
      .date {
        color: #666;
        font-size: 0.85rem;
        font-family: sans-serif;
      }

      .header-actions {
        display: flex;
        gap: 0.4rem;
      }

      .btn {
        font-family: sans-serif;
        font-size: 0.85rem;
        padding: 0.35rem 0.75rem;
        border: 1px solid #d0d0d0;
        background: #fff;
        border-radius: 4px;
        cursor: pointer;
      }

      .btn.active {
        background: #121212;
        color: #fff;
      }

      /* Topic pills */
      .topics {
        display: flex;
        gap: 0.5rem;
        padding: 1rem 0;
        border-bottom: 1px solid #e0e0e0;
        overflow-x: auto;
      }

      .topic-pill {
        font-family: sans-serif;
        font-size: 0.85rem;
        padding: 0.4rem 0.9rem;
        border: 1px solid #d0d0d0;
        background: #fff;
        border-radius: 999px;
        cursor: pointer;
        white-space: nowrap;
      }

      .topic-pill.active {
        background: #121212;
        color: #fff;
        border-color: #121212;
      }

      /* Stories */
      .stories {
        padding-top: 1rem;
      }

      .story {
        padding: 1.5rem 0;
        border-bottom: 1px solid #e0e0e0;
      }

      .story-header {
        display: flex;
        justify-content: space-between;
        gap: 1rem;
        cursor: pointer;
      }

      .story-main {
        flex: 1;
      }

      .story-topic {
        font-family: sans-serif;
        font-size: 0.75rem;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        margin-bottom: 0.3rem;
        font-weight: 600;
      }

      .story-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.4rem;
        line-height: 1.35;
      }

      .story-summary {
        color: #4a4a4a;
        font-size: 0.95rem;
        line-height: 1.5;
      }

      .story-star {
        font-size: 1.3rem;
        color: #d0d0d0;
        cursor: pointer;
        user-select: none;
      }

      .story-star.saved {
        color: #121212;
      }

      /* Expandable details */
      .story-details {
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #e8e8e8;
        display: none;
      }

      .story.expanded .story-details {
        display: block;
      }

      .detail-section {
        margin-bottom: 1rem;
      }

      .detail-title {
        font-family: sans-serif;
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: #666;
        margin-bottom: 0.4rem;
        font-weight: 600;
      }

      .detail-body {
        font-size: 0.9rem;
        color: #333;
      }

      .detail-body ul {
        padding-left: 1.3rem;
      }

      .detail-body li {
        margin-bottom: 0.3rem;
      }

      .sources {
        display: flex;
        flex-wrap: wrap;
        gap: 0.35rem;
      }

      .source-tag {
        font-family: sans-serif;
        font-size: 0.75rem;
        padding: 0.3rem 0.6rem;
        border: 1px solid #d0d0d0;
        background: #fafafa;
        border-radius: 4px;
        text-decoration: none;
        color: #333;
      }

      .insights-box {
        background: #f8f8f8;
        border-left: 3px solid #121212;
        padding: 0.75rem;
      }

      .insights-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 0.4rem;
      }

      .insights-toggle {
        font-family: sans-serif;
        font-size: 0.72rem;
        padding: 0.2rem 0.5rem;
        border: 1px solid #d0d0d0;
        background: #fff;
        border-radius: 4px;
        cursor: pointer;
      }

      .insights-list {
        padding-left: 1.2rem;
        font-size: 0.88rem;
      }

      .insights-list.hidden {
        display: none;
      }

      .actions {
        margin-top: 1rem;
        padding-top: 0.6rem;
        border-top: 1px solid #e8e8e8;
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }

      /* Modals */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        z-index: 100;
        display: none;
        align-items: flex-end;
      }

      .modal.open {
        display: flex;
      }

      .modal-panel {
        background: #fff;
        width: 100%;
        max-height: 75vh;
        border-radius: 20px 20px 0 0;
        padding: 1.2rem;
        overflow-y: auto;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 0.8rem;
        border-bottom: 1px solid #e0e0e0;
      }

      .modal-header h2 {
        font-size: 1.1rem;
      }

      .close-btn {
        font-size: 1.5rem;
        background: none;
        border: none;
        cursor: pointer;
      }

      .filter-group {
        margin-bottom: 1.5rem;
      }

      .filter-group-title {
        font-family: sans-serif;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: #666;
        margin-bottom: 0.5rem;
        font-weight: 600;
      }

      .filter-options {
        display: flex;
        flex-wrap: wrap;
        gap: 0.4rem;
      }

      .filter-chip {
        font-family: sans-serif;
        font-size: 0.8rem;
        padding: 0.35rem 0.7rem;
        border: 1px solid #d0d0d0;
        background: #fff;
        border-radius: 999px;
        cursor: pointer;
      }

      .filter-chip.active {
        background: #121212;
        color: #fff;
      }

      /* Chat */
      .chat-fab {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        width: 56px;
        height: 56px;
        border-radius: 50%;
        background: #121212;
        color: #fff;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        z-index: 50;
      }

      .chat-body {
        font-family: sans-serif;
        font-size: 0.9rem;
        color: #666;
        margin-bottom: 1rem;
      }

      .chat-example {
        padding: 0.5rem;
        margin: 0.3rem 0;
        background: #f8f8f8;
        border-radius: 8px;
        font-size: 0.85rem;
        cursor: pointer;
      }

      .chat-input-row {
        display: flex;
        gap: 0.5rem;
      }

      .chat-input {
        flex: 1;
        font-family: sans-serif;
        font-size: 0.9rem;
        padding: 0.7rem;
        border: 1px solid #d0d0d0;
        border-radius: 8px;
      }

      .chat-send {
        padding: 0.7rem 1.2rem;
        background: #121212;
        color: #fff;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
      }

      @media (min-width: 600px) {
        h1 {
          font-size: 2.5rem;
        }
        .story-title {
          font-size: 1.3rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div>
        <h1 id="title">Today's News</h1>
        <div class="date" id="date">Saturday, February 7, 2026</div>
      </div>
      <div class="header-actions">
        <button class="btn" id="filter-btn">‚öôÔ∏è</button>
        <button class="btn active" data-mode="daily">Today</button>
        <button class="btn" data-mode="weekly">Week</button>
      </div>
    </div>

    <div class="topics">
      <button class="topic-pill active" data-topic="all">All</button>
      <button class="topic-pill" data-topic="security">Security</button>
      <button class="topic-pill" data-topic="politics">Politics</button>
      <button class="topic-pill" data-topic="economy">Economy</button>
      <button class="topic-pill" data-topic="actors">Key Actors</button>
      <button class="topic-pill" data-country="Saudi Arabia">üá∏üá¶ Saudi</button>
      <button class="topic-pill" data-country="Syria">üá∏üáæ Syria</button>
      <button class="topic-pill" data-country="Sudan">üá∏üá© Sudan</button>
      <button class="topic-pill" data-country="Iran">üáÆüá∑ Iran</button>
    </div>

    <div class="stories" id="stories"></div>

    <!-- Filters Modal -->
    <div class="modal" id="filters-modal">
      <div class="modal-panel">
        <div class="modal-header">
          <h2>Filters & Settings</h2>
          <button class="close-btn" onclick="closeModal('filters-modal')">√ó</button>
        </div>
        <div class="filter-group">
          <div class="filter-group-title">News Outlets / ÿßŸÑŸÖÿµÿßÿØÿ±</div>
          <div class="filter-options" id="outlet-filters"></div>
        </div>
      </div>
    </div>

    <!-- Chat Modal -->
    <button class="chat-fab" id="chat-btn">üí¨</button>
    <div class="modal" id="chat-modal">
      <div class="modal-panel">
        <div class="modal-header">
          <h2>Ask the Brief / ÿßÿ≥ÿ£ŸÑ ÿßŸÑŸÖŸÑÿÆÿµ</h2>
          <button class="close-btn" onclick="closeModal('chat-modal')">√ó</button>
        </div>
        <div class="chat-body">
          <p><strong>Ask me anything about today's events:</strong></p>
          <div id="chat-examples"></div>
        </div>
        <div class="chat-input-row">
          <input class="chat-input" id="chat-input" type="text" placeholder="Type your question..." />
          <button class="chat-send" onclick="sendChat()">Send</button>
        </div>
      </div>
    </div>

    <script>
      // RSS Feeds
      const RSS_FEEDS = [
        { outlet: 'arabnews', url: 'https://www.arabnews.com/rss', name: 'Arab News' },
        { outlet: 'middleeasteye', url: 'https://middleeasteye.net/rss', name: 'Middle East Eye' },
        { outlet: 'syrianobserver', url: 'https://syrianobserver.com/feed', name: 'The Syrian Observer' },
        { outlet: 'spa', url: 'https://www.spa.gov.sa/rss.xml', name: 'ŸàŸÉÿßŸÑÿ© ÿßŸÑÿ£ŸÜÿ®ÿßÿ° ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©' }
      ];

      // Clean metadata from RSS content
      function cleanMetadata(text) {
        // Remove common metadata patterns
        text = text
          .replace(/<[^>]*>/g, '') // HTML tags
          .replace(/&[^;]+;/g, ' ') // HTML entities
          .replace(/\b(By|by)\s+[A-Z][a-z]+\s+[A-Z][a-z]+\b/g, '') // "By Reporter Name"
          .replace(/\b\d{1,2}:\d{2}\s*(AM|PM|am|pm)?\b/g, '') // Times
          .replace(/\b(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)[a-z]*\.?\s+\d{1,2},?\s+\d{4}\b/gi, '') // Dates
          .replace(/\b\d{4}-\d{2}-\d{2}\b/g, '') // ISO dates
          .replace(/\b(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday)\b/gi, '') // Day names
          .replace(/\bReuters\b|\bAFP\b|\bAP\b/g, '') // Wire services
          .replace(/\s{2,}/g, ' ') // Multiple spaces
          .replace(/^\s*[-‚Äì‚Äî]\s*/g, '') // Leading dashes
          .trim();
        
        return text;
      }

      // Clean text for speech (more aggressive)
      function cleanTextForSpeech(text) {
        return text
          .replace(/<[^>]*>/g, '')
          .replace(/&[^;]+;/g, ' ')
          .replace(/\d{1,2}:\d{2}\s*(AM|PM|am|pm)?/g, '') // Remove times
          .replace(/(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)[a-z]*\.?\s+\d{1,2},?\s+\d{4}/gi, '') // Remove dates
          .replace(/\d{4}-\d{2}-\d{2}/g, '') // Remove ISO dates
          .replace(/(Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday)/gi, '') // Remove day names
          .replace(/By\s+[A-Z][a-z]+\s+[A-Z][a-z]+/g, '') // Remove bylines
          .replace(/[^\w\s.,!?-]/g, '') // Special chars except punctuation
          .replace(/\s+/g, ' ')
          .trim();
      }

      // Detect country
      function detectCountry(title, summary) {
        const text = (title + ' ' + summary).toLowerCase();
        
        if (text.match(/\b(saudi|riyadh|jeddah|kingdom|ksa|mbs|crown prince)\b/)) return 'Saudi Arabia';
        if (text.match(/\b(syria|damascus|aleppo|idlib|assad|syrian)\b/)) return 'Syria';
        if (text.match(/\b(sudan|khartoum|rsf|burhan|hemedti|sudanese)\b/)) return 'Sudan';
        if (text.match(/\b(iran|tehran|iranian|irgc|ayatollah|khamenei)\b/)) return 'Iran';
        if (text.match(/\b(egypt|cairo|egyptian|sisi)\b/)) return 'Egypt';
        if (text.match(/\b(uae|dubai|abu dhabi|emirates)\b/)) return 'UAE';
        if (text.match(/\b(qatar|doha|qatari)\b/)) return 'Qatar';
        if (text.match(/\b(yemen|houthi|sanaa|aden|yemeni)\b/)) return 'Yemen';
        if (text.match(/\b(iraq|baghdad|iraqi|mosul)\b/)) return 'Iraq';
        if (text.match(/\b(turkey|ankara|erdogan|turkish)\b/)) return 'Turkey';
        if (text.match(/\b(israel|jerusalem|netanyahu|israeli)\b/)) return 'Israel';
        if (text.match(/\b(palestine|gaza|west bank|hamas|palestinian)\b/)) return 'Palestine';
        if (text.match(/\b(lebanon|beirut|hezbollah|lebanese)\b/)) return 'Lebanon';
        if (text.match(/\b(jordan|amman|jordanian)\b/)) return 'Jordan';
        
        return 'Regional';
      }

      // Improved categorization
      function categorizeStory(title, summary) {
        const text = (title + ' ' + summary).toLowerCase();
        
        // Security keywords (most specific first)
        if (text.match(/\b(military|attack|strike|weapon|forces|troops|war|conflict|security|defense|drone|missile|clash|combat|militant|terror|bombing|explosion|violence|killed|casualties|armed)\b/)) {
          return 'security';
        }
        
        // Economy keywords
        if (text.match(/\b(economy|trade|market|oil|opec|investment|currency|gdp|inflation|imf|bank|finance|billion|dollar|economic|price|export|import|stock|revenue|budget)\b/)) {
          return 'economy';
        }
        
        // Politics keywords
        if (text.match(/\b(election|government|minister|president|parliament|diplomatic|summit|talks|agreement|treaty|visit|cabinet|policy|legislation|law|reform|vote|leader|official)\b/)) {
          return 'politics';
        }
        
        // Default
        return 'actors';
      }

      // Generate context
      function generateContext(title, summary, country, outlet) {
        const contexts = [];
        
        if (country && country !== 'Regional') {
          contexts.push(`Event in ${country}`);
        }
        
        const text = (title + ' ' + summary).toLowerCase();
        
        if (text.match(/\b(gcc|gulf|cooperation|saudi|uae|qatar|kuwait|oman|bahrain)\b/)) {
          contexts.push('GCC regional implications');
        } else if (text.match(/\b(iran|sanctions|nuclear|irgc)\b/)) {
          contexts.push('Part of Iran regional strategy');
        } else if (text.match(/\b(israel|palestine|gaza|west bank)\b/)) {
          contexts.push('Israeli-Palestinian conflict developments');
        } else if (text.match(/\b(syria|iraq|levant)\b/)) {
          contexts.push('Levant stability considerations');
        }
        
        contexts.push(`Source: ${outlet}`);
        
        return contexts.slice(0, 3);
      }

      // Generate insights
      function generateInsights(title, summary, topic, country) {
        const text = (title + ' ' + summary).toLowerCase();
        const insights = [];
        
        if (topic === 'security') {
          insights.push('<strong>Watch:</strong> Escalation/de-escalation signals from key actors');
          
          if (text.match(/\b(gaza|palestine|israel)\b/)) {
            insights.push('<strong>Risk:</strong> Regional spillover potential');
          } else if (text.match(/\b(houthi|red sea|maritime)\b/)) {
            insights.push('<strong>Impact:</strong> Global trade and energy routes');
          } else if (text.match(/\b(iran|irgc|proxy)\b/)) {
            insights.push('<strong>Concern:</strong> Regional proxy dynamics');
          }
        } else if (topic === 'politics') {
          insights.push('<strong>Watch:</strong> Official reactions and follow-up moves');
          
          if (text.match(/\b(saudi|iran|dialogue|talks)\b/)) {
            insights.push('<strong>Significance:</strong> Regional power balance shift');
          } else if (text.match(/\b(election|reform|vote)\b/)) {
            insights.push('<strong>Context:</strong> Domestic political trajectory');
          }
        } else if (topic === 'economy') {
          insights.push('<strong>Watch:</strong> Market and policy responses');
          
          if (text.match(/\b(oil|opec|energy)\b/)) {
            insights.push('<strong>Impact:</strong> Global energy market effects');
          } else if (text.match(/\b(currency|inflation|imf)\b/)) {
            insights.push('<strong>Risk:</strong> Economic stability concerns');
          }
        } else {
          insights.push('<strong>Watch:</strong> Follow developments and statements');
        }
        
        if (insights.length < 2) {
          insights.push('<strong>Context:</strong> Part of regional trends');
        }
        
        return insights.slice(0, 3);
      }

      // Fetch RSS feeds
      async function fetchRealNews() {
        const allStories = [];
        let storyId = 1;
        
        for (const feed of RSS_FEEDS) {
          try {
            const response = await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feed.url)}`);
            const data = await response.json();
            
            if (data.status === 'ok' && data.items) {
              data.items.slice(0, 7).forEach(item => {
                const rawContent = item.description || item.content || '';
                let cleanContent = cleanMetadata(rawContent);
                
                // Extract meaningful content (skip if too short after cleaning)
                if (cleanContent.length < 100) {
                  cleanContent = item.title; // Fallback to title if content too short
                }
                
                // Create summary (longer, up to 500 chars)
                const summary = cleanContent.substring(0, 500) + (cleanContent.length > 500 ? '...' : '');
                const country = detectCountry(item.title, cleanContent);
                const topic = categorizeStory(item.title, cleanContent);
                
                const story = {
                  id: storyId++,
                  mode: 'daily',
                  topic: topic,
                  country: country,
                  title: item.title,
                  summary: summary || 'Read full article at source.',
                  context: generateContext(item.title, cleanContent, country, feed.name),
                  sources: [{ name: feed.name, url: item.link || '#', outlet: feed.outlet }],
                  insights: generateInsights(item.title, cleanContent, topic, country)
                };
                allStories.push(story);
              });
            }
          } catch (error) {
            console.error(`Failed to fetch ${feed.name}:`, error);
          }
        }
        
        return allStories;
      }

      let DATA = [];

      const OUTLETS = ["middleeasteye", "arabnews", "syrianobserver", "spa"];
      const CHAT_EXAMPLES = [
        "What are the main security concerns today?",
        "Summarize Saudi Arabia developments",
        "Compare economic stories",
        "ŸÑÿÆŸëÿµ ÿ£ŸáŸÖ ÿßŸÑÿ£ÿÆÿ®ÿßÿ± ÿßŸÑŸäŸàŸÖ"
      ];

      let mode = "daily";
      let topic = "all";
      let currentCountry = null;
      let saved = new Set();
      let outlets = new Set(OUTLETS);

      function render() {
        const filtered = DATA.filter(s => 
          s.mode === mode && 
          (topic === "all" || s.topic === topic) && 
          (!currentCountry || s.country === currentCountry) &&
          s.sources.some(src => outlets.has(src.outlet))
        );

        const html = filtered.map(s => {
          const star = saved.has(s.id) ? "‚òÖ" : "‚òÜ";
          const starClass = saved.has(s.id) ? "saved" : "";
          const activeSources = s.sources.filter(src => outlets.has(src.outlet));

          return `
            <div class="story" data-id="${s.id}">
              <div class="story-header" onclick="toggleStory(${s.id})">
                <div class="story-main">
                  <div class="story-topic">${s.topic}${s.country ? ' ‚Ä¢ ' + s.country : ''}</div>
                  <h2 class="story-title">${s.title}</h2>
                  <p class="story-summary">${s.summary}</p>
                </div>
                <div class="story-star ${starClass}" onclick="event.stopPropagation();toggleStar(${s.id})">${star}</div>
              </div>
              <div class="story-details">
                <div class="detail-section">
                  <div class="detail-title">Sources / ÿßŸÑŸÖÿµÿßÿØÿ±</div>
                  <div class="sources">
                    ${activeSources.map(src => `<a href="${src.url}" class="source-tag" target="_blank">${src.name}</a>`).join("")}
                  </div>
                </div>
                <div class="detail-section">
                  <div class="detail-title">Context / ÿßŸÑÿ≥ŸäÿßŸÇ</div>
                  <div class="detail-body"><ul>${s.context.map(c => `<li>${c}</li>`).join("")}</ul></div>
                </div>
                <div class="detail-section">
                  <div class="insights-box">
                    <div class="insights-header">
                      <div class="detail-title" style="margin:0">Forward View / ÿßŸÑŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÖÿ≥ÿ™ŸÇÿ®ŸÑŸäÿ©</div>
                      <button class="insights-toggle" onclick="toggleInsights(${s.id})">Hide</button>
                    </div>
                    <ul class="insights-list" id="insights-${s.id}">${s.insights.map(i => `<li>${i}</li>`).join("")}</ul>
                  </div>
                </div>
                <div class="actions">
                  <button class="btn" onclick="speakStory(${s.id})">üîä Listen</button>
                  <button class="btn" onclick="askAbout('${s.title.replace(/'/g, "\\'")}')">üí¨ Ask</button>
                </div>
              </div>
            </div>
          `;
        }).join("");

        document.getElementById("stories").innerHTML = html || '<p style="padding:2rem 0;text-align:center;color:#999">No stories match your filters.</p>';
      }

      function toggleStory(id) {
        document.querySelector(`[data-id="${id}"]`).classList.toggle("expanded");
      }

      function toggleStar(id) {
        if (saved.has(id)) saved.delete(id);
        else saved.add(id);
        render();
      }

      function toggleInsights(id) {
        const list = document.getElementById(`insights-${id}`);
        const btn = list.previousElementSibling.querySelector(".insights-toggle");
        list.classList.toggle("hidden");
        btn.textContent = list.classList.contains("hidden") ? "Show" : "Hide";
      }

      // Google TTS
      const GOOGLE_API_KEY = 'AIzaSyA6FCtmBvNRT68pkaYVHGDmhhb83Ea1RcU';

      async function speak(text) {
        try {
          const response = await fetch(`https://texttospeech.googleapis.com/v1/text:synthesize?key=${GOOGLE_API_KEY}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              input: { text: text },
              voice: {
                languageCode: 'en-US',
                name: 'en-US-Neural2-D',
                ssmlGender: 'MALE'
              },
              audioConfig: {
                audioEncoding: 'MP3',
                pitch: 0,
                speakingRate: 1.08
              }
            })
          });

          const data = await response.json();
          
          if (data.audioContent) {
            const audio = new Audio('data:audio/mp3;base64,' + data.audioContent);
            audio.play();
          } else {
            console.error('Google TTS Error:', data);
            alert('Voice playback failed.');
          }
        } catch (error) {
          console.error('Speech error:', error);
          alert('Voice playback failed.');
        }
      }

      function speakStory(id) {
        const story = DATA.find(s => s.id === id);
        if (!story) return;
        
        const cleanTitle = cleanTextForSpeech(story.title);
        const cleanSummary = cleanTextForSpeech(story.summary);
        const text = cleanTitle + '. ' + cleanSummary;
        
        speak(text);
      }

      function askAbout(title) {
        document.getElementById("chat-input").value = `Tell me more about: ${title}`;
        openModal("chat-modal");
      }

      function openModal(id) {
        document.getElementById(id).classList.add("open");
      }

      function closeModal(id) {
        document.getElementById(id).classList.remove("open");
      }

      function sendChat() {
        const val = document.getElementById("chat-input").value.trim();
        if (val) {
          alert(`AI chat coming soon!\n\nYour question: "${val}"`);
          document.getElementById("chat-input").value = "";
        }
      }

      // Event listeners
      document.querySelectorAll("[data-mode]").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll("[data-mode]").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          mode = btn.dataset.mode;
          document.getElementById("title").textContent = mode === "weekly" ? "This Week's News" : "Today's News";
          document.getElementById("date").textContent = mode === "weekly" ? "Week of Feb 1‚Äì7, 2026" : "Saturday, February 7, 2026";
          render();
        });
      });

      document.querySelectorAll(".topic-pill").forEach(btn => {
        btn.addEventListener("click", () => {
          document.querySelectorAll(".topic-pill").forEach(b => b.classList.remove("active"));
          btn.classList.add("active");
          
          if (btn.dataset.topic) {
            topic = btn.dataset.topic;
            currentCountry = null;
          } else if (btn.dataset.country) {
            currentCountry = btn.dataset.country;
            topic = 'all';
          }
          
          render();
        });
      });

      document.getElementById("filter-btn").onclick = () => openModal("filters-modal");
      document.getElementById("chat-btn").onclick = () => openModal("chat-modal");

      // Init outlet filters
      document.getElementById("outlet-filters").innerHTML = OUTLETS.map(o => {
        const names = {
          middleeasteye: "Middle East Eye",
          arabnews: "Arab News",
          syrianobserver: "The Syrian Observer",
          spa: "ŸàŸÉÿßŸÑÿ© ÿßŸÑÿ£ŸÜÿ®ÿßÿ° ÿßŸÑÿ≥ÿπŸàÿØŸäÿ©"
        };
        return `<button class="filter-chip active" onclick="toggleOutlet('${o}')" data-outlet="${o}">${names[o]}</button>`;
      }).join("");

      function toggleOutlet(o) {
        const btn = document.querySelector(`[data-outlet="${o}"]`);
        if (outlets.has(o)) {
          outlets.delete(o);
          btn.classList.remove("active");
        } else {
          outlets.add(o);
          btn.classList.add("active");
        }
        render();
      }

      // Init chat examples
      document.getElementById("chat-examples").innerHTML = CHAT_EXAMPLES.map(ex =>
        `<div class="chat-example" onclick="document.getElementById('chat-input').value='${ex}'">${ex}</div>`
      ).join("");

      // Load news
      async function init() {
        document.getElementById('stories').innerHTML = '<p style="padding:2rem 0;text-align:center;color:#999">üì° Loading latest news...</p>';
        const realNews = await fetchRealNews();
        DATA = realNews;
        render();
      }
      
      init();
    </script>
  </body>
</html>
